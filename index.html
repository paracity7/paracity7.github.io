<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Solo Farming</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="width: 100%;padding: 10px">

<div id="google_translate_element"></div>

<script type="text/javascript">
    function googleTranslateElementInit() {
        new google.translate.TranslateElement({pageLanguage: 'kr'}, 'google_translate_element');
    }
</script>
<input type="text" id="new_max_chap" style="width: 20px">
<button onclick="setNewList()">Set New List</button>
<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
<select id="foo" onchange="readTextFile()"></select>

<p id="tbMain" style="white-space: pre-wrap"></p>

<script>

    createDropDown();
    readTextFile();

    function setNewList() {
        var newMaxChap = document.getElementById("new_max_chap").value;
        if (newMaxChap) {
            createDropDown(newMaxChap);
        }
    }

    function createDropDown(currentChap) {
        var elm = document.getElementById('foo'),
            df = document.createDocumentFragment();

        elm.innerHTML = "";
        var defaultOp = document.createElement('option');
        defaultOp.appendChild(document.createTextNode("Select Chapter"));
        df.appendChild(defaultOp)

        var maxChap = 322;
        if (currentChap) {
            maxChap = currentChap;
        }
        for (var i = 1; i <= maxChap; i++) {
            var fullNum = pad(i, 3);
            var option = document.createElement('option');
            option.value = fullNum;
            option.appendChild(document.createTextNode("Chapter " + fullNum));
            df.appendChild(option);
        }
        elm.appendChild(df);
    }

    function pad(n, length) {
        var len = length - (''+n).length;
        return (len > 0 ? new Array(++len).join('0') : '') + n
    }

    function readTextFile(){
        var htmlValue = document.getElementById("foo").value;
        if (htmlValue) {
            var file = "chap/" + htmlValue + ".txt";
            document.getElementById('tbMain').innerHTML = null;
            var rawFile = new XMLHttpRequest();
            rawFile.open("GET", file, false);
            rawFile.onreadystatechange = function () {
                if (rawFile.readyState === 4) {
                    if (rawFile.status === 200 || rawFile.status == 0) {
                        document.getElementById('tbMain').innerHTML = rawFile.responseText;
                    }
                }
            }
            rawFile.send(null);
        }
    }
</script>

</body>
</html>
